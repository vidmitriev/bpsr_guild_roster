# 实时图表可视化功能使用说明

## ?? 功能概述

实时图表可视化系统是基于自定义扁平化图表控件构建的专业数据分析工具，为游戏战斗数据提供直观的可视化展示和深度分析功能。

## ?? 核心特性

### 系统优势
- **?? 100%中文支持**: 完美的中文字体显示，无乱码问题
- **?? 扁平化现代设计**: 符合现代UI设计标准，视觉效果优雅
- **?? 智能主题适配**: 明暗主题无缝切换，与主程序保持一致
- **? 高性能渲染**: 基于.NET原生Graphics API，响应迅速
- **?? 高度可定制**: 丰富的配置选项和交互功能

## ?? 图表类型详解

### 1. DPS趋势图 (FlatLineChart)
**核心用途**: 展示玩家DPS随时间的变化趋势

#### ?? **主要特性**
- **平滑曲线**: 3个以上数据点自动使用平滑曲线绘制
- **多系列支持**: 可同时显示多名玩家的DPS曲线
- **智能配色**: 10色循环配色方案，易于区分
- **实时更新**: 高频数据刷新(100ms间隔)
- **交互操作**: 支持拖动、缩放、重置等操作

#### ?? **交互功能**
```
??? 左键拖动: 平移时间轴视图
?? Ctrl+滚轮: 缩放时间轴
?? R键: 重置视图到默认状态
??? 悬停提示: 显示精确的时间和DPS数值
```

#### ?? **数据来源与刷新**
- **数据源**: ChartVisualizationService实时DPS历史记录
- **更新频率**: 100毫秒一次高频更新
- **历史容量**: 最多保存500个数据点
- **显示范围**: 默认显示最近60秒，支持1-300秒回看

### 2. 技能伤害占比饼图 (FlatPieChart)
**核心用途**: 分析单个玩家的技能伤害分布情况

#### ?? **主要特性**
- **扁平化色彩**: 10种精选扁平化配色
- **智能标签**: 透明背景确保清晰度和可读性
- **灵活显示**: 可选择显示标签名/百分比
- **自动计算**: 百分比和角度自动计算
- **玩家选择**: 下拉菜单快速切换分析目标

#### ?? **显示逻辑**
```csharp
// 数据处理
- 显示TOP8技能伤害占比
- 其余技能合并为"其他"
- 按伤害总量降序排列
- 实时计算百分比分布
```

#### ?? **使用流程**
1. **选择玩家**: 使用顶部下拉菜单选择目标玩家
2. **查看占比**: 饼图自动显示该玩家的技能分布
3. **悬停详情**: 鼠标悬停查看具体数值和百分比
4. **实时更新**: 数据自动刷新，无需手动操作

### 3. 团队DPS对比条形图 (FlatBarChart)
**核心用途**: 对比分析团队成员的DPS表现

#### ?? **主要特性**
- **多彩条形**: 10种精选扁平化颜色
- **无边框设计**: 简洁现代的视觉效果
- **智能标签**: 玩家名45度旋转显示，避免重叠
- **数值显示**: 条形顶部显示格式化数值
- **Y轴优化**: 强制从0开始，范围自动扩展10%

#### ?? **数据展示**
- **排序方式**: 按总DPS从高到低排列
- **显示内容**: 玩家昵称 + 总平均DPS
- **数值格式**: 使用K/M/B单位格式化
- **更新机制**: 跟随主数据自动更新

### 4. 多维度散点图 (FlatScatterChart)
**核心用途**: 分析DPS与暴击率的相关性

#### ?? **主要特性**
- **圆形标记**: 8px圆形标记点，清晰易识别
- **双轴优化**: X轴Y轴都强制从0开始
- **多玩家对比**: 支持最多5名玩家同时显示
- **颜色区分**: 每名玩家使用不同颜色
- **精确坐标**: 坐标轴范围自动优化

#### ?? **坐标系统**
```
X轴: 暴击率 (%)
Y轴: 总平均DPS
原点: (0, 0)
范围: 自动计算最优显示区间
```

### 5. 伤害分布条形图 (FlatBarChart复用)
**核心用途**: 展示玩家伤害类型分布

#### ?? **主要特性**
- **TOP6显示**: 显示伤害最高的6名玩家
- **总伤害对比**: 基于累计总伤害进行对比
- **颜色突出**: 不同颜色突出显示差异
- **实时排序**: 数据变化时自动重新排序

## ?? 图表交互操作指南

### DPS趋势图交互
| 操作 | 功能 | 说明 |
|------|------|------|
| **左键拖动** | 平移视图 | 在图表区域内拖动查看不同时间段 |
| **Ctrl+滚轮** | 时间轴缩放 | 放大缩小时间显示范围 |
| **R键** | 重置视图 | 恢复到默认60秒显示范围 |
| **鼠标悬停** | 数据提示 | 显示精确的时间点和DPS数值 |

### 通用图表操作
| 操作 | 功能 | 说明 |
|------|------|------|
| **窗口拖动** | 移动窗口 | 在顶部控制面板区域拖动整个窗口 |
| **手动刷新** | 更新数据 | 点击"手动刷新"按钮立即更新所有图表 |
| **自动刷新** | 自动更新 | 切换自动刷新模式(默认开启) |
| **主题切换** | 外观变更 | 跟随主程序自动切换明暗主题 |

## ?? 访问入口与使用方法

### 打开图表窗口
```
主界面 → 设置按钮(??) → "实时图表"
```

### 前置条件检查
1. **数据要求**: 必须有战斗数据才能打开图表窗口
2. **提示信息**: 无数据时会显示友好的提示消息
3. **自动检测**: 系统自动检查数据可用性

### 使用步骤
1. **开始监控**: 启动游戏数据监控功能
2. **进行战斗**: 产生一些战斗数据
3. **打开图表**: 通过设置菜单进入实时图表
4. **选择玩家**: 在技能占比图中选择要分析的玩家
5. **查看分析**: 切换不同选项卡查看各种图表
6. **交互操作**: 使用拖动、缩放等功能深入分析

## ??? 技术架构与API

### 核心服务类
```csharp
ChartVisualizationService // 图表可视化服务
├── CreateDpsTrendChart()           // 创建DPS趋势图
├── CreateSkillDamagePieChart()     // 创建技能占比饼图  
├── CreateTeamDpsBarChart()         // 创建团队DPS对比图
├── CreateDpsRadarChart()           // 创建多维度散点图
└── CreateDamageTypeStackedChart()  // 创建伤害分布图
```

### 数据管理接口
```csharp
// 数据更新
UpdateAllDataPoints()              // 批量更新数据点
AddDpsDataPoint()                 // 添加DPS数据点
AddHpsDataPoint()                 // 添加HPS数据点

// 图表刷新
RefreshDpsTrendChart()            // 刷新DPS趋势图
RefreshSkillDamagePieChart()      // 刷新技能饼图
RefreshTeamDpsBarChart()          // 刷新团队条形图
RefreshDpsRadarChart()            // 刷新散点图
RefreshDamageTypeStackedChart()   // 刷新伤害分布图
```

### 主题系统
```csharp
// 全局主题管理
RefreshAllChartThemes()           // 刷新所有图表主题
RefreshChartsTheme()              // 刷新特定图表主题

// 自动适配
- 明色主题: 白色背景 + 黑色文字 + 浅色网格
- 暗色主题: 深灰背景 + 白色文字 + 深色网格
```

## ?? 高级配置与自定义

### 自动刷新配置
```csharp
// 刷新频率设置
SetAutoRefreshInterval(100);      // 设置100毫秒间隔
GetRefreshInterval();             // 获取当前刷新间隔
IsAutoRefreshEnabled;             // 检查自动刷新状态
```

### 数据历史管理
```csharp
// 历史数据控制
MaxHistoryPoints = 500;           // 最大历史点数
ClearAllHistory();                // 清空历史数据
ReloadPersistentData();          // 重载持久化数据
```

### 视图控制(DPS趋势图专用)
```csharp
// 缩放和视图
SetTimeScale(1.5f);              // 设置时间轴缩放1.5倍
SetViewOffset(30.0f);            // 设置视图偏移30秒
ResetViewToDefault();            // 重置到默认视图
GetViewTimeRange();              // 获取当前视图时间范围
```

## ?? 视觉设计特色

### 色彩方案
```csharp
// 10色循环调色板
Color.FromArgb(255, 99, 132)     // 红色系
Color.FromArgb(54, 162, 235)     // 蓝色系
Color.FromArgb(255, 206, 86)     // 黄色系
Color.FromArgb(75, 192, 192)     // 青色系
Color.FromArgb(153, 102, 255)    // 紫色系
// ... 更多颜色
```

### 字体设计
```csharp
// 统一字体方案
标题字体: "Microsoft YaHei", 14px, Bold
轴标签: "Microsoft YaHei", 11px, Regular
数据标签: "Microsoft YaHei", 10px, Regular
```

### 布局优化
- **边距设置**: 精心设计的边距确保内容不会贴边显示
- **自适应布局**: 图表随窗口大小自动调整
- **响应式设计**: 支持不同分辨率和DPI设置
- **无障碍友好**: 高对比度设计，易于阅读

## ?? 性能优化

### 渲染优化
```csharp
// 高质量渲染设置
g.SmoothingMode = SmoothingMode.HighQuality;
g.TextRenderingHint = TextRenderingHint.ClearTypeGridFit;
g.CompositingQuality = CompositingQuality.HighQuality;
g.InterpolationMode = InterpolationMode.HighQualityBicubic;
```

### 内存管理
- **自动资源释放**: Graphics对象和画笔自动释放
- **数据点限制**: 历史数据自动清理，防止内存溢出
- **缓存机制**: 持久化数据缓存，提高响应速度

### 更新频率控制
- **高频刷新**: 100毫秒间隔，确保实时性
- **异步处理**: 数据处理不阻塞UI线程
- **智能跳帧**: 无数据变化时自动跳过渲染

## ?? 用户体验设计

### 直观操作
- **拖拽友好**: 窗口和图表都支持直观的拖拽操作
- **快捷键支持**: R键快速重置，Ctrl+滚轮缩放
- **视觉反馈**: 操作时有明确的视觉反馈和光标变化
- **状态显示**: 实时显示缩放倍数和当前时间信息

### 智能提示
- **悬停提示**: 详细的数据提示信息
- **操作指南**: 无数据时显示使用方法
- **状态指示**: 清晰的自动刷新状态指示
- **错误处理**: 友好的错误提示和恢复机制

### 响应式界面
- **自适应布局**: 组件随窗口大小智能调整
- **主题一致性**: 与主程序保持视觉一致
- **多分辨率支持**: 适配不同屏幕分辨率和DPI
- **流畅动画**: 平滑的过渡和交互效果

## ?? 使用注意事项

### 数据要求
1. **最低数据量**: 需要至少进行一些战斗才能显示图表
2. **实时性**: 图表数据基于实时监控，停止监控后数据不再更新
3. **准确性**: 确保网络监控正常工作，避免数据丢失

### 性能考虑
1. **CPU使用**: 高频刷新会消耗一定CPU资源
2. **内存占用**: 大量历史数据会占用内存空间
3. **渲染性能**: 复杂图表可能影响整体程序响应速度

### 兼容性
1. **分辨率适配**: 建议1920x1080以上分辨率使用
2. **系统要求**: Windows 7及以上系统
3. **.NET版本**: 需要.NET 8.0运行时支持

## ?? 未来发展计划

### 即将推出
- [ ] 更多图表类型（雷达图、热力图等）
- [ ] 数据导出功能（PNG、PDF、Excel等）
- [ ] 自定义配色方案
- [ ] 图表标注和备注功能
- [ ] 历史数据对比视图

### 长期规划
- [ ] 3D立体图表展示
- [ ] 动画过渡效果增强
- [ ] 机器学习趋势预测
- [ ] 云端数据同步
- [ ] 移动端适配版本

---

## ?? 快速上手指南

### 第一次使用
1. **启动程序** → 选择网卡 → 开始监控
2. **进行战斗** → 产生数据 → 等待统计
3. **打开图表** → 设置 → 实时图表
4. **探索功能** → 切换图表 → 尝试交互
5. **深入分析** → 选择玩家 → 查看详情

### 常见问题
**Q: 为什么图表显示"暂无数据"？**  
A: 需要先开启监控并进行一些战斗，产生足够的数据后图表才会显示内容。

**Q: DPS趋势图如何缩放？**  
A: 按住Ctrl键的同时滚动鼠标滚轮即可缩放时间轴，按R键可重置视图。

**Q: 如何切换要分析的玩家？**  
A: 在技能占比图页面，使用左上角的下拉菜单选择不同的玩家。

**Q: 图表不更新怎么办？**  
A: 检查自动刷新是否开启，或点击"手动刷新"按钮强制更新数据。

---

**开发团队**: StarResonanceDpsAnalysis  
**版本**: v2.0.0  
**更新时间**: 2024年12月  
**技术支持**: 基于.NET 8.0 + 自定义Graphics渲染引擎